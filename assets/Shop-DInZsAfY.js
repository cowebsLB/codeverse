import{u as w,s as f,r as x,j as e,I as A,o as P,P as U,Q as E,R as M,a as B,q as T,S as X,T as Y,U as G,V as R,O}from"./index-CA7PqEiE.js";import{g as q}from"./iconMapper-DaW-93tQ.js";const H=[{id:"xp_boost_2x",name:"2x XP Boost",description:"Double your XP gain for 1 hour",type:"xp_boost",icon:"âš¡",cost:100,effect:{duration:60,multiplier:2},maxQuantity:5},{id:"xp_boost_3x",name:"3x XP Boost",description:"Triple your XP gain for 30 minutes",type:"xp_boost",icon:"ðŸš€",cost:200,effect:{duration:30,multiplier:3},maxQuantity:3},{id:"coin_boost_2x",name:"2x Coin Boost",description:"Double your coin earnings for 1 hour",type:"coin_boost",icon:"ðŸ’°",cost:150,effect:{duration:60,multiplier:2},maxQuantity:5},{id:"streak_freeze",name:"Streak Freeze",description:"Protect your streak for one day",type:"streak_freeze",icon:"â„ï¸",cost:50,effect:{amount:1},maxQuantity:10},{id:"hint",name:"Lesson Hint",description:"Get a hint for the current lesson",type:"hint",icon:"ðŸ’¡",cost:25,effect:{amount:1},maxQuantity:20},{id:"time_extension",name:"Time Extension",description:"Add 10 minutes to lesson timer",type:"time_extension",icon:"â°",cost:30,effect:{amount:10},maxQuantity:15}];function V(){const{user:a}=w(),{coins:r,spendCoins:g}=f(),[i,d]=x.useState({}),[S,h]=x.useState(!1);x.useEffect(()=>{if(!a?.id)return;let t=!1;return(async()=>{try{const o=await U(a.id);t||d(o)}catch(o){t||(console.error("Failed to load power-ups:",o),d({}))}})(),()=>{t=!0}},[a?.id]);const j=async t=>{if(!a?.id)return;if(r<t.cost){alert("Not enough coins!");return}if(t.maxQuantity&&(i[t.id]||0)>=t.maxQuantity){alert(`You already have the maximum quantity (${t.maxQuantity})`);return}h(!0),await g(t.cost)?(await E(a.id,t.id,1),await loadPowerUps(),alert(`Purchased ${t.name}!`)):alert("Purchase failed!"),h(!1)},p=async t=>{if(a?.id){if((i[t.id]||0)<=0){alert("You don't have any of this power-up!");return}try{if(await M(a.id,t.id)){try{const o=await U(a.id);d(o)}catch(o){console.error("Failed to reload power-ups:",o)}switch(t.type){case"xp_boost":alert(`${t.name} activated! XP gain is now ${t.effect.multiplier}x for ${t.effect.duration} minutes.`);break;case"coin_boost":alert(`${t.name} activated! Coin earnings are now ${t.effect.multiplier}x for ${t.effect.duration} minutes.`);break;case"streak_freeze":const v=await f.getState().useStreakFreeze();alert(v?`${t.name} used! Your streak is protected.`:"Failed to use streak freeze!");break;case"hint":alert(`${t.name} used! Check the lesson for hints.`);break;case"time_extension":alert(`${t.name} used! You have ${t.effect.amount} more minutes.`);break}}else alert("Failed to use power-up!")}catch(l){console.error("Failed to use power-up:",l),alert("Failed to use power-up! Please try again.")}}},b=t=>i[t]||0;return e.jsxs("div",{className:"bg-gray-800 border border-gray-700 rounded-lg p-6",children:[e.jsxs("h3",{className:"text-xl font-bold font-heading text-white mb-4 flex items-center gap-2",children:[e.jsx(A,{className:"inline"})," Power-Up Shop"]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4",children:H.map(t=>{const l=b(t.id),o=r>=t.cost&&(!t.maxQuantity||l<t.maxQuantity);return e.jsxs("div",{className:"bg-gray-700 border border-gray-600 rounded-lg p-4 hover:border-indigo-500 transition-all",children:[e.jsx("div",{className:"flex items-start justify-between mb-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[q(t.icon,"text-2xl"),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-bold font-heading text-white",children:t.name}),e.jsx("p",{className:"text-xs text-gray-400 font-body",children:t.description})]})]})}),e.jsxs("div",{className:"flex items-center justify-between mt-3 pt-3 border-t border-gray-600",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"text-xs text-yellow-400 font-code mb-1 flex items-center gap-1",children:[e.jsx(P,{className:"inline"})," ",t.cost," coins"]}),l>0&&e.jsxs("div",{className:"text-xs text-indigo-400 font-code",children:["Owned: ",l]})]}),e.jsxs("div",{className:"flex gap-2",children:[l>0&&e.jsx("button",{onClick:()=>p(t),className:"bg-green-600 text-white px-3 py-1 rounded text-xs font-medium hover:bg-green-700 transition-colors",children:"Use"}),e.jsx("button",{onClick:()=>j(t),disabled:!o||S,className:`px-3 py-1 rounded text-xs font-medium transition-colors ${o?"bg-indigo-600 text-white hover:bg-indigo-700":"bg-gray-600 text-gray-400 cursor-not-allowed"}`,children:"Buy"})]})]})]},t.id)})})]})}const W=[{id:"avatar-1",name:"Code Master",description:"Unlock by reaching Level 10",type:"avatar",rarity:"rare",icon:"ðŸ‘¨â€ðŸ’»",cost:0,requirement:{type:"level",value:10}},{id:"avatar-2",name:"Python Pro",description:"Unlock by mastering Python",type:"avatar",rarity:"epic",icon:"ðŸ",cost:0,requirement:{type:"languages_mastered",value:1}},{id:"avatar-3",name:"Streak Champion",description:"Unlock by maintaining a 30-day streak",type:"avatar",rarity:"legendary",icon:"ðŸ”¥",cost:0,requirement:{type:"streak",value:30}},{id:"avatar-4",name:"Golden Coder",description:"Purchase with 500 coins",type:"avatar",rarity:"epic",icon:"ðŸ‘‘",cost:500},{id:"theme-1",name:"Neon Theme",description:"Unlock by completing 50 lessons",type:"theme",rarity:"rare",icon:"ðŸ’¡",cost:0,requirement:{type:"lessons_completed",value:50}},{id:"theme-2",name:"Matrix Theme",description:"Purchase with 300 coins",type:"theme",rarity:"epic",icon:"ðŸŸ¢",cost:300},{id:"theme-3",name:"Solarized Theme",description:"Purchase with 250 coins",type:"theme",rarity:"rare",icon:"â˜€ï¸",cost:250},{id:"badge-1",name:"First Steps",description:"Unlock by completing your first lesson",type:"badge",rarity:"common",icon:"ðŸŽ¯",cost:0,requirement:{type:"achievement",value:1,achievementId:"hello_world"}},{id:"badge-2",name:"Polyglot",description:"Unlock by mastering 5 languages",type:"badge",rarity:"legendary",icon:"ðŸ—£ï¸",cost:0,requirement:{type:"languages_mastered",value:5}},{id:"title-1",name:"Novice Coder",description:"Unlock by reaching Level 5",type:"title",rarity:"common",icon:"ðŸ“",cost:0,requirement:{type:"level",value:5}},{id:"title-2",name:"Code Wizard",description:"Purchase with 1000 coins",type:"title",rarity:"legendary",icon:"ðŸ§™",cost:1e3},{id:"effect-1",name:"Confetti Effect",description:"Unlock by completing 25 lessons",type:"effect",rarity:"rare",icon:"ðŸŽŠ",cost:0,requirement:{type:"lessons_completed",value:25}},{id:"effect-2",name:"Fireworks Effect",description:"Purchase with 400 coins",type:"effect",rarity:"epic",icon:"ðŸŽ†",cost:400},{id:"bg-1",name:"Space Background",description:"Unlock by reaching Level 15",type:"background",rarity:"epic",icon:"ðŸŒŒ",cost:0,requirement:{type:"level",value:15}},{id:"bg-2",name:"Cyber Background",description:"Purchase with 600 coins",type:"background",rarity:"legendary",icon:"ðŸŒ",cost:600}];function F(a,r){if(a.cost>0&&r.coins<a.cost)return{canUnlock:!1,reason:`Need ${a.cost-r.coins} more coins`};if(a.requirement){const{type:g,value:i,achievementId:d}=a.requirement;switch(g){case"level":if(r.level<i)return{canUnlock:!1,reason:`Reach level ${i}`};break;case"streak":if(r.streak<i)return{canUnlock:!1,reason:`Maintain a ${i}-day streak`};break;case"lessons_completed":if(r.lessonsCompleted<i)return{canUnlock:!1,reason:`Complete ${i} lessons`};break;case"languages_mastered":if(r.languagesMastered<i)return{canUnlock:!1,reason:`Master ${i} language${i>1?"s":""}`};break;case"achievement":if(d&&!r.achievements.includes(d))return{canUnlock:!1,reason:"Unlock the required achievement"};break}}return{canUnlock:!0}}function J(){const{user:a}=w(),{coins:r,spendCoins:g,unlockedAchievements:i,currentStreak:d}=f(),{xp:S,level:h,getAllLanguageProgress:j}=B(),[p,b]=x.useState([]),[t,l]=x.useState([]),[o,v]=x.useState(0),[C,_]=x.useState(0);x.useEffect(()=>a?.id?((async()=>{await Promise.all([k(),z()])})(),()=>{}):void 0,[a?.id]);const k=async()=>{if(a?.id)try{const s=await X(a.id);b(s);const c=await Y(a.id);l(c)}catch(s){console.error("Failed to load unlockables:",s),b([]),l([])}},z=async()=>{try{const s=await j(),c=s.filter(m=>m.completed).length;v(c);const n=s.reduce((m,u)=>m+u.completedLessons,0);_(n)}catch(s){console.error("Failed to load languages:",s),v(0),_(0)}},$=async s=>{if(!a?.id)return;const c={level:h,streak:d,lessonsCompleted:C,languagesMastered:o,achievements:i,coins:r},{canUnlock:n,reason:m}=F(s,c);if(!n){alert(m||"Cannot unlock this item");return}if(p.includes(s.id)){const u=t.includes(s.id);await G(a.id,s.id,!u),await k();return}if(s.cost>0&&!await g(s.cost)){alert("Not enough coins!");return}await R(a.id,s.id),await k(),alert(`Unlocked: ${s.name}!`)},I=s=>{const c={level:h,streak:d,lessonsCompleted:C,languagesMastered:o,achievements:i,coins:r},{canUnlock:n,reason:m}=F(s,c),u=p.includes(s.id),y=t.includes(s.id);return{canUnlock:n,reason:m,isUnlocked:u,isActive:y}},L={common:"border-gray-500",rare:"border-blue-500",epic:"border-purple-500",legendary:"border-yellow-500"},Q=W.reduce((s,c)=>(s[c.type]||(s[c.type]=[]),s[c.type].push(c),s),{});return e.jsxs("div",{className:"bg-gray-800 border border-gray-700 rounded-lg p-6",children:[e.jsxs("h3",{className:"text-xl font-bold font-heading text-white mb-4 flex items-center gap-2",children:[e.jsx(T,{className:"inline"})," Unlockables Shop"]}),e.jsx("div",{className:"space-y-6",children:Object.entries(Q).map(([s,c])=>e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-bold font-heading text-gray-300 mb-3 capitalize",children:s.replace("_"," ")}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4",children:c.map(n=>{const{canUnlock:m,reason:u,isUnlocked:y,isActive:N}=I(n);return e.jsxs("div",{className:`bg-gray-700 border-2 rounded-lg p-4 transition-all ${y?N?`${L[n.rarity]} bg-opacity-50`:"border-green-500":m?"border-gray-600 hover:border-indigo-500":"border-gray-700 opacity-60"}`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[q(n.icon,"text-2xl"),e.jsxs("div",{children:[e.jsx("h5",{className:"text-sm font-bold font-heading text-white",children:n.name}),e.jsx("p",{className:"text-xs text-gray-400 font-body",children:n.description})]})]}),y&&e.jsx("span",{className:"text-xs text-green-400 font-code",children:"âœ“"})]}),e.jsxs("div",{className:"flex items-center justify-between mt-3 pt-3 border-t border-gray-600",children:[n.cost>0?e.jsxs("span",{className:"text-xs text-yellow-400 font-code flex items-center gap-1",children:[e.jsx(P,{className:"inline"})," ",n.cost," coins"]}):e.jsx("span",{className:"text-xs text-indigo-400 font-code",children:"Free"}),y?e.jsx("button",{onClick:()=>$(n),className:`text-xs px-3 py-1 rounded font-medium ${N?"bg-green-600 text-white":"bg-gray-600 text-gray-300 hover:bg-gray-500"}`,children:N?"Active":"Activate"}):e.jsx("button",{onClick:()=>$(n),disabled:!m,className:`text-xs px-3 py-1 rounded font-medium ${m?"bg-indigo-600 text-white hover:bg-indigo-700":"bg-gray-600 text-gray-400 cursor-not-allowed"}`,children:m?"Unlock":u||"Locked"})]})]},n.id)})})]},s))})]})}function D(){const{user:a,initialized:r}=w(),g=f(d=>d.initialized),i=f(d=>d.coins);return!r||!g?e.jsx("div",{className:"min-h-screen bg-gray-900 py-12 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-500 mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-400 font-body",children:"Loading shop..."})]})}):e.jsx("div",{className:"min-h-screen bg-gray-900 py-12",children:e.jsxs("div",{className:"max-w-6xl mx-auto px-4 sm:px-6 lg:px-8",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("h1",{className:"text-4xl font-bold font-heading text-white mb-2",children:[e.jsx(O,{className:"inline mr-2"})," Shop"]}),e.jsx("p",{className:"text-gray-400 font-body text-lg",children:"Purchase power-ups and unlockables to enhance your learning experience"}),e.jsx("div",{className:"mt-4 flex items-center gap-4",children:e.jsx("div",{className:"bg-gray-800 border border-gray-700 rounded-lg px-6 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(P,{className:"text-2xl"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-400 font-body",children:"Your Coins"}),e.jsx("div",{className:"text-2xl font-bold font-heading text-yellow-500",children:i.toLocaleString()})]})]})})})]}),e.jsx("div",{className:"mb-8",children:e.jsx(V,{})}),e.jsx("div",{className:"mb-8",children:e.jsx(J,{})})]})})}export{D as default};
